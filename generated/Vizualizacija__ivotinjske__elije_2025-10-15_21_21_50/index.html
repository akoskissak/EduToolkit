<html lang="sr"><head>
<meta charset="utf-8">
<title>Vizualizacija životinjske ćelije</title>
<meta name="viewport" content="width=device-width,initial-scale=1">
<style>
  /* Audience: osnovnoškolci i srednjoškolci */
  :root{
    --bg: #f6fdff;
    --cell-edge: #2b6b70;
    --cyto: #e6fbff;
    --label-bg: rgba(255,255,255,0.9);
    --text: #01303a;
  }
  html,body{height:100%;margin:0;font-family:Segoe UI, Roboto, Arial, sans-serif;background:linear-gradient(#f8ffff, #eafcff);color:var(--text);}
  .container{max-width:980px;margin:18px auto;padding:18px;}
  h1{margin:0 0 8px;font-size:28px;color:#073843;}
  p.description{margin:0 0 18px;background:linear-gradient(90deg, rgba(255,255,255,0.7), rgba(255,255,255,0.4));padding:12px;border-radius:8px;border:1px solid rgba(0,0,0,0.04);}
  .scene{background:transparent;border-radius:12px;box-shadow:0 6px 18px rgba(3,46,50,0.08);padding:10px;}
  svg{width:100%;height:600px;display:block;}

  /* Labels */
  .label { font-size:13px; fill:#072b30; font-weight:600; pointer-events:none; }
  .label-bg { fill:var(--label-bg); stroke:#ddd; stroke-width:0.8; rx:6; ry:6; }

  /* Organelle base styles */
  .cell-membrane { fill:var(--cyto); stroke:var(--cell-edge); stroke-width:8; filter:drop-shadow(0 6px 10px rgba(3,46,50,0.06)); }
  .nucleus { fill:#cfe9ff; stroke:#8cbfe6; stroke-width:4; cursor:pointer; }
  .nucleus-dots { fill:#8bb7df; opacity:0.7; }
  .mito { fill:#c6efd8; stroke:#2e9a66; stroke-width:2.5; cursor:pointer; }
  .mito-fold { stroke:#2e9a66; stroke-width:1.5; fill:none; opacity:0.9; }
  .er { fill:none; stroke:#ffd976; stroke-width:8; stroke-linecap:round; cursor:pointer; filter:drop-shadow(0 3px 6px rgba(255,185,0,0.06)); }
  .er-tube { stroke:#ffd976; stroke-width:10; stroke-linecap:round; }
  .lyso { fill:#ffcccc; stroke:#c43a3a; stroke-width:1.2; cursor:pointer; }
  .ribosome { fill:#cfcfcf; stroke:#9a9a9a; stroke-width:0.6; }

  /* Popup (prozorčić) */
  .popup {
    position: absolute;
    min-width:220px;
    max-width:320px;
    background:linear-gradient(180deg,#fff,#f9fdff);
    border:1px solid rgba(3,46,50,0.08);
    border-radius:10px;
    padding:10px 12px;
    box-shadow:0 8px 20px rgba(3,46,50,0.12);
    z-index:50;
    font-size:14px;
    color:#06323a;
  }
  .popup h3{margin:0 0 6px;font-size:15px;color:#06323a;}
  .popup p{margin:0;font-size:13px;line-height:1.3;}
  .popup .close{position:absolute;right:6px;top:6px;background:transparent;border:none;color:#777;font-weight:700;cursor:pointer;font-size:14px;}
  .close:focus{outline:2px solid rgba(3,46,50,0.12);}

  /* Animations and highlights */
  .glow-blue { filter: drop-shadow(0 0 14px rgba(70,150,240,0.6)); transition:filter 0.35s; }
  .glow-yellow { filter: drop-shadow(0 0 16px rgba(255,200,20,0.6)); transition:filter 0.35s; }
  .pulse-red { animation:lyso-pulse 700ms ease-out 0s 2; }
  @keyframes lyso-pulse {
    0% { transform:scale(1); opacity:1; }
    50% { transform:scale(1.35); opacity:0.9; }
    100% { transform:scale(1); opacity:1; }
  }
  .mito-wave { animation:mito-wave 900ms ease-in-out 0s 3; transform-origin:center; }
  @keyframes mito-wave {
    0% { transform:translateX(0) rotate(0deg); }
    25% { transform:translateX(4px) rotate(1.5deg); }
    50% { transform:translateX(0) rotate(0deg); }
    75% { transform:translateX(-4px) rotate(-1.5deg); }
    100% { transform:translateX(0) rotate(0deg); }
  }

  /* Pointer lines */
  .pointer { stroke:#044047; stroke-width:1.2; fill:none; opacity:0.9; }

  /* small legend */
  .legend { display:flex; gap:10px; margin-top:8px; align-items:center; flex-wrap:wrap; font-size:13px; color:#074047; }
  .legend-item { display:flex; align-items:center; gap:6px; background:rgba(255,255,255,0.85); padding:6px 8px; border-radius:8px; border:1px solid rgba(0,0,0,0.04); }
  .swatch { width:16px; height:12px; border-radius:3px; border:1px solid rgba(0,0,0,0.06); }

  /* Responsive tweaks */
  @media (max-width:720px){
    svg{height:520px;}
    .container{padding:12px;}
  }
</style>
</head>
<body>
<div class="container">
  <h1>Vizualizacija životinjske ćelije</h1>
  <p class="description">Ovaj interaktivni alat omogućava učenicima da istraže unutrašnju strukturu životinjske ćelije. Na ekranu se prikazuje jednostavan model ćelij sa njenim osnovnim komponentama. Klikom na svaku komponentu otvara se prozorčić sa kratkim objašnjenjem o njenoj ulozi u funkcionisanju ćelije.</p>

  <div class="scene" id="sceneWrap">
    <svg id="scene" viewBox="0 0 800 600" xmlns="http://www.w3.org/2000/svg" role="img" aria-label="Model životinjske ćelije">
      <!-- Cell membrane (oval) -->
      <ellipse class="cell-membrane" cx="400" cy="300" rx="320" ry="220"></ellipse>

      <!-- Cytoplasm is represented by the fill of the membrane; label -->
      <g id="labels">
        <!-- Pointer for Cell membrane -->
        <line class="pointer" x1="120" y1="120" x2="210" y2="160"></line>
        <rect x="200" y="150" width="180" height="28" class="label-bg"></rect>
        <text x="210" y="170" class="label">Ćelijska membrana</text>

        <!-- Cytoplasm -->
        <line class="pointer" x1="680" y1="110" x2="580" y2="200"></line>
        <rect x="565" y="185" width="120" height="28" class="label-bg"></rect>
        <text x="575" y="205" class="label">Citoplazma</text>
      </g>

      <!-- Nucleus (central) -->
      <g id="nucleusGroup" transform="translate(0,0)" style="cursor:pointer;">
        <circle id="nucleus" class="nucleus" cx="400" cy="300" r="90" style="opacity: 1; transform: scale(1); transition: opacity 600ms, transform 600ms;"></circle>
        <!-- dotted texture -->
        <g id="nucleusDots">
          <!-- create dots pattern inside nucleus -->
          <g class="nucleus-dots">
            <!-- rows -->
            <g transform="translate(360,260)">
              <circle cx="0" cy="0" r="3"></circle>
              <circle cx="18" cy="0" r="2.5"></circle>
              <circle cx="36" cy="0" r="3"></circle>
            </g>
            <g transform="translate(350,282)">
              <circle cx="0" cy="0" r="2.4"></circle>
              <circle cx="20" cy="0" r="2.7"></circle>
              <circle cx="42" cy="0" r="2.2"></circle>
            </g>
            <g transform="translate(360,304)">
              <circle cx="0" cy="0" r="2.6"></circle>
              <circle cx="18" cy="0" r="3"></circle>
              <circle cx="36" cy="0" r="2.4"></circle>
            </g>
            <g transform="translate(350,326)">
              <circle cx="0" cy="0" r="2.2"></circle>
              <circle cx="22" cy="0" r="2.6"></circle>
              <circle cx="42" cy="0" r="2.3"></circle>
            </g>
          </g>
        </g>
        <!-- pointer for nucleus label -->
        <line class="pointer" x1="470" y1="220" x2="440" y2="255"></line>
        <rect x="470" y="202" width="95" height="28" class="label-bg"></rect>
        <text x="482" y="222" class="label">Nukleus</text>
      </g>

      <!-- Endoplasmic reticulum (ER) around nucleus -->
      <g id="erGroup" style="cursor:pointer;">
        <!-- several curved tubes -->
        <path id="er1" class="er-tube er" d="M340,240 C300,240 280,270 300,300 C320,330 360,330 380,310"></path>
        <path id="er2" class="er-tube er" d="M420,240 C460,240 490,270 470,300 C450,330 410,330 390,310"></path>
        <path id="er3" class="er-tube er" d="M320,320 C290,340 270,370 300,390 C330,410 360,390 370,370"></path>
        <path id="er4" class="er-tube er" d="M480,320 C510,340 540,360 520,390 C500,420 470,400 450,380"></path>
        <!-- label pointer -->
        <line class="pointer" x1="320" y1="170" x2="340" y2="210"></line>
        <rect x="230" y="150" width="220" height="28" class="label-bg"></rect>
        <text x="240" y="170" class="label">Endoplazmatski retikulum</text>
      </g>

      <!-- Mitochondria (several) -->
      <g id="mitoGroup">
        <g id="mito1" class="mito" transform="translate(0,0)" style="cursor:pointer;">
          <ellipse cx="260" cy="210" rx="34" ry="18" class="mito"></ellipse>
          <path class="mito-fold" d="M238,200 C252,206 268,196 284,203"></path>
        </g>
        <g id="mito2" class="mito" style="cursor:pointer;">
          <ellipse cx="520" cy="220" rx="36" ry="20" class="mito"></ellipse>
          <path class="mito-fold" d="M500,210 C516,218 532,207 548,214"></path>
        </g>
        <g id="mito3" class="mito" style="cursor:pointer;">
          <ellipse cx="300" cy="380" rx="32" ry="18" class="mito"></ellipse>
          <path class="mito-fold" d="M282,372 C298,378 314,369 332,374"></path>
        </g>
        <g id="mito4" class="mito" style="cursor:pointer;">
          <ellipse cx="520" cy="360" rx="34" ry="19" class="mito"></ellipse>
          <path class="mito-fold" d="M500,352 C516,358 532,350 548,355"></path>
        </g>
        <!-- pointer label for mitochondria -->
        <line class="pointer" x1="570" y1="100" x2="520" y2="170"></line>
        <rect x="540" y="82" width="160" height="28" class="label-bg"></rect>
        <text x="552" y="102" class="label">Mitohondrije</text>
      </g>

      <!-- Lysosomes (small red circles) -->
      <g id="lysoGroup">
        <circle id="lyso1" class="lyso" cx="460" cy="260" r="8" style="cursor:pointer;"></circle>
        <circle id="lyso2" class="lyso" cx="360" cy="200" r="7" style="cursor:pointer;"></circle>
        <circle id="lyso3" class="lyso" cx="440" cy="360" r="7" style="cursor:pointer;"></circle>
        <circle id="lyso4" class="lyso" cx="300" cy="320" r="6" style="cursor:pointer;"></circle>
      </g>

      <!-- Ribosomes: small grey dots scattered -->
      <g id="riboGroup">
        <circle class="ribosome" cx="320" cy="240" r="3"></circle>
        <circle class="ribosome" cx="360" cy="250" r="3"></circle>
        <circle class="ribosome" cx="410" cy="260" r="3"></circle>
        <circle class="ribosome" cx="450" cy="230" r="3"></circle>
        <circle class="ribosome" cx="480" cy="280" r="3"></circle>
        <circle class="ribosome" cx="420" cy="330" r="3"></circle>
        <circle class="ribosome" cx="350" cy="320" r="3"></circle>
        <circle class="ribosome" cx="520" cy="300" r="3"></circle>
        <circle class="ribosome" cx="280" cy="300" r="3"></circle>
      </g>

      <!-- Small legend -->
      <g id="legend" transform="translate(520,430)">
        <rect x="0" y="0" width="250" height="110" rx="10" ry="10" fill="rgba(255,255,255,0.9)" stroke="#e6f6f6"></rect>
        <text x="12" y="20" class="label" style="font-size:13px">Legenda:</text>
        <rect x="12" y="30" width="18" height="10" fill="#cfe9ff" stroke="#8cbfe6"></rect><text x="36" y="40" class="label" style="font-size:12px">Nukleus</text>
        <rect x="12" y="48" width="18" height="10" fill="#c6efd8" stroke="#2e9a66"></rect><text x="36" y="58" class="label" style="font-size:12px">Mitohondrija</text>
        <rect x="12" y="66" width="18" height="10" fill="#ffd976" stroke="#e0b34b"></rect><text x="36" y="76" class="label" style="font-size:12px">Endoplazmatski retikulum</text>
        <rect x="12" y="84" width="18" height="10" fill="#ffcccc" stroke="#c43a3a"></rect><text x="36" y="94" class="label" style="font-size:12px">Lizozom</text>
      </g>
    </svg>
  </div>
</div>

<!-- popup container -->
<div id="popupContainer" style="position:fixed; left:0; top:0; width:100%; height:100%; pointer-events:none;"></div>

<script>
  // Data-driven interactions mapping (from provided JSON)
  const interactions = [
    {
      key: 'nucleus',
      if: 'Klik na nukleus',
      then_first: 'Nukleus je kontrolni centar ćelije. On čuva DNK i reguliše rad ćelije',
      then_next: ['istakni nukleus plavim sjajem']
    },
    {
      keyPrefix: 'mito', // applies to mito1..mito4
      if: 'klik na mitohondriju',
      then_first: 'Mitohondrije proizvode energiju za ćeliju, poznate i kao energetske centrale.',
      then_next: ['dodaj animaciju talasanja koje simbolizuje energiju']
    },
    {
      key: 'er',
      if: 'klik na endoplazmatski retikulum',
      then_first: 'Endoplazmatski retikulum pomaže u sintezi proteina i lipida.',
      then_next: ['naglasiti ga žutim sjajem']
    },
    {
      keyPrefix: 'lyso',
      if: 'klik na lizozom',
      then_first: 'Lizozomi razgrađuju otpadne materije u ćeliji',
      then_next: ['animacija kratko pulsiranje crvene boje']
    }
  ];

  // Click counters per object id
  const clickCounts = {};

  const popupContainer = document.getElementById('popupContainer');
  const svg = document.getElementById('scene');

  // Utility: show popup near coordinates
  function showPopup(textTitle, textBody, x, y) {
    // Remove any existing popup from container
    const id = 'popup-' + Date.now();
    const div = document.createElement('div');
    div.className = 'popup';
    div.id = id;
    div.style.pointerEvents = 'auto';

    const closeBtn = document.createElement('button');
    closeBtn.className = 'close';
    closeBtn.innerText = '✕';
    closeBtn.onclick = () => { div.remove(); };

    const h3 = document.createElement('h3');
    h3.innerText = textTitle;

    const p = document.createElement('p');
    p.innerText = textBody;

    div.appendChild(closeBtn);
    div.appendChild(h3);
    div.appendChild(p);

    popupContainer.appendChild(div);

    // position: convert svg point to screen coords
    const pt = svg.createSVGPoint();
    pt.x = x; pt.y = y;
    const ctm = svg.getScreenCTM();
    const screenPt = pt.matrixTransform(ctm);

    // place to right/down unless near edge
    const margin = 12;
    const width = 260;
    let left = screenPt.x + 10;
    let top = screenPt.y - 10;
    if (left + width + 20 > window.innerWidth) left = screenPt.x - width - 10;
    if (top + 120 > window.innerHeight) top = window.innerHeight - 140;
    if (top < 10) top = 10;

    div.style.left = left + 'px';
    div.style.top = top + 'px';

    return div;
  }

  // Action handlers mapping for then_next strings
  function handleAction(action, targetEl) {
    action = action.toLowerCase();
    if (action.includes('plavim sjajem') || action.includes('istakni nukleus')) {
      // add glow-blue to nucleus
      const el = document.getElementById('nucleus');
      if (el) el.classList.add('glow-blue');
    } else if (action.includes('talasanja') || action.includes('talas')) {
      // mitochondria wave animation; add class then remove after animation end
      if (!targetEl) return;
      targetEl.classList.add('mito-wave');
      // remove after animation finishes (3 iterations set in CSS)
      setTimeout(()=>{ targetEl.classList.remove('mito-wave'); }, 3000);
    } else if (action.includes('žutim sjajem') || action.includes('naglasiti')) {
      // highlight ER group
      const erGroup = document.getElementById('erGroup');
      if (erGroup) {
        // apply to all er paths
        const paths = erGroup.querySelectorAll('.er');
        paths.forEach(p => p.classList.add('glow-yellow'));
        // keep glow for a while
        setTimeout(()=>{ paths.forEach(p => p.classList.remove('glow-yellow')); }, 2500);
      }
    } else if (action.includes('pulsiranje') || action.includes('puls')) {
      // lysosome pulse: target element pulses
      if (!targetEl) return;
      targetEl.classList.add('pulse-red');
      setTimeout(()=>{ targetEl.classList.remove('pulse-red'); }, 1600);
    }
  }

  // Generic click handler factory
  function makeClickHandler(id, mapEntry) {
    return function(evt) {
      evt.stopPropagation();
      const target = evt.currentTarget;
      // ensure count exists
      clickCounts[id] = (clickCounts[id] || 0) + 1;
      const count = clickCounts[id];

      // first click -> then_first shows popup with short text
      if (count === 1) {
        // Determine title and specific text
        let title = '';
        let text = '';
        // decide which mapping used
        if (mapEntry) {
          title = mapEntry.if;
          text = mapEntry.then_first;
        } else {
          // fallback generic
          title = 'Informacija';
          text = 'Ovo je organela ćelije.';
        }
        // compute approximate click coords relative to svg
        // use bounding box center
        const bbox = target.getBBox();
        const cx = bbox.x + bbox.width/2;
        const cy = bbox.y + bbox.height/2;
        showPopup(title, text, cx, cy);
      } else {
        // subsequent clicks -> then_next sequential execution
        const seq = mapEntry.then_next || [];
        // index: second click => idx 0, third => 1, etc.
        const idx = Math.min(seq.length - 1, count - 2);
        if (seq.length > 0) {
          const action = seq[idx];
          handleAction(action, target);
        }
      }
    };
  }

  // Wire up nucleus
  (function(){
    const nucleus = document.getElementById('nucleusGroup');
    const entry = interactions.find(it => it.key === 'nucleus');
    nucleus.addEventListener('click', makeClickHandler('nucleus', entry));
  })();

  // Wire up ER: group with id 'erGroup'
  (function(){
    const erGroup = document.getElementById('erGroup');
    const entry = interactions.find(it => it.key === 'er');
    // clicking any of the ER tubes triggers it
    erGroup.addEventListener('click', function(evt){
      // delegate to path clicked or group
      const id = 'er';
      clickCounts[id] = (clickCounts[id] || 0) + 1;
      const count = clickCounts[id];
      if (count === 1) {
        // approximate center near nucleus
        showPopup(entry.if, entry.then_first, 400, 260);
      } else {
        const seq = entry.then_next || [];
        const idx = Math.min(seq.length - 1, count - 2);
        if (seq.length>0) handleAction(seq[idx], erGroup);
      }
      evt.stopPropagation();
    });
  })();

  // Wire up mitochondria individually
  (function(){
    const mitoNodes = ['mito1','mito2','mito3','mito4'];
    const entry = interactions.find(it => it.keyPrefix === 'mito');
    mitoNodes.forEach(id => {
      const g = document.getElementById(id);
      if (g) {
        g.addEventListener('click', function(evt){
          // For clicks on group, target the group element for animation
          clickCounts[id] = (clickCounts[id] || 0) + 1;
          const count = clickCounts[id];
          if (count === 1) {
            // show popup near element's center
            const bbox = g.getBBox();
            showPopup('Mitohondrija', entry.then_first, bbox.x + bbox.width/2, bbox.y + bbox.height/2);
          } else {
            const seq = entry.then_next || [];
            const idx = Math.min(seq.length - 1, count - 2);
            if (seq.length>0) handleAction(seq[idx], g);
          }
          evt.stopPropagation();
        });
      }
    });
  })();

  // Wire up lysosomes individually
  (function(){
    const lysoIds = ['lyso1','lyso2','lyso3','lyso4'];
    const entry = interactions.find(it => it.keyPrefix === 'lyso');
    lysoIds.forEach(id => {
      const el = document.getElementById(id);
      if (el) {
        el.addEventListener('click', function(evt){
          clickCounts[id] = (clickCounts[id] || 0) + 1;
          const count = clickCounts[id];
          if (count === 1) {
            const bbox = el.getBBox();
            showPopup('Lizozom', entry.then_first, bbox.x + bbox.width/2, bbox.y + bbox.height/2);
          } else {
            const seq = entry.then_next || [];
            const idx = Math.min(seq.length - 1, count - 2);
            if (seq.length>0) handleAction(seq[idx], el);
          }
          evt.stopPropagation();
        });
      }
    });
  })();

  // Dismiss popup when clicking outside (but keep pointer events for popup)
  document.addEventListener('click', function(){
    // remove all popup children
    const children = Array.from(popupContainer.children);
    children.forEach(c => c.remove());
  });

  // Prevent body click from removing popup immediately when clicking inside svg organelle (stopPropagation used)
  // Provide keyboard accessibility: close popups on Escape
  document.addEventListener('keydown', function(e){
    if (e.key === 'Escape') {
      const children = Array.from(popupContainer.children);
      children.forEach(c => c.remove());
    }
  });

  // Small hint: initial subtle entrance animations
  window.addEventListener('load', function(){
    // subtle fade in of nucleus dots
    const nucleus = document.getElementById('nucleus');
    nucleus.style.opacity = 0;
    nucleus.style.transform = 'scale(0.98)';
    setTimeout(()=>{ nucleus.style.transition = 'opacity 600ms ease, transform 600ms ease'; nucleus.style.opacity = 1; nucleus.style.transform = 'scale(1)'; }, 120);
  });
</script>

</body></html>