<!DOCTYPE html>
<html lang="sr">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Gde da izgradimo grad?</title>
    <style>
      body {
        margin: 0;
        padding: 0;
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        background: #eef5ea;
        display: flex;
        flex-direction: column;
        height: 100vh;
      }
      h1 {
        text-align: center;
        margin: 20px 0 10px 0;
        font-size: 2.5rem;
        color: #2c3e50;
      }
      p.description {
        text-align: center;
        max-width: 720px;
        margin: 0 auto 20px auto;
        font-size: 1.15rem;
        color: #34495e;
      }
      #container {
        flex: 1;
        display: flex;
        max-width: 960px;
        margin: 0 auto 30px auto;
        background: #ffffffdd;
        border-radius: 10px;
        box-shadow: 0 6px 12px rgb(0 0 0 / 0.1);
        overflow: hidden;
      }
      #mapArea {
        flex: 2;
        position: relative;
        background: #a3d2ca;
      }
      svg {
        width: 100%;
        height: 100%;
        display: block;
      }
      #infoPanel {
        flex: 1;
        background: #f4f6f8;
        border-left: 2px solid #ccd1d9;
        padding: 20px;
        box-sizing: border-box;
        font-size: 1rem;
        color: #2f4050;
        display: flex;
        flex-direction: column;
        justify-content: flex-start;
      }
      #infoPanel p {
        margin-top: 0;
        line-height: 1.4;
      }
      #infoPanel .text-content {
        flex: 1;
      }
      #btnReset {
        background: #2c3e50;
        color: #fff;
        border: none;
        border-radius: 6px;
        padding: 12px 18px;
        cursor: pointer;
        font-weight: 600;
        font-size: 1rem;
        transition: background-color 0.3s ease;
        margin-top: 15px;
      }
      #btnReset:hover {
        background: #34495e;
      }
      .area {
        cursor: pointer;
        transition: fill-opacity 0.3s ease, stroke-width 0.3s ease;
      }
      .area:hover {
        fill-opacity: 0.7;
      }
      /* Animations */
      .boat {
        transform-origin: center;
        animation: floatBoat 4s ease-in-out infinite;
      }
      @keyframes floatBoat {
        0%,
        100% {
          transform: translateY(0);
        }
        50% {
          transform: translateY(-6px);
        }
      }
      .smoke {
        animation: smokeRise 3s linear infinite;
        opacity: 0.8;
      }
      @keyframes smokeRise {
        0% {
          transform: translateY(0) scale(1);
          opacity: 0.8;
        }
        100% {
          transform: translateY(-30px) scale(1.5);
          opacity: 0;
        }
      }
      .lumberjack-arm {
        transform-origin: 15px 35px;
        animation: chopArm 1.2s ease-in-out infinite;
      }
      @keyframes chopArm {
        0%,
        100% {
          transform: rotate(10deg);
        }
        50% {
          transform: rotate(-20deg);
        }
      }
    </style>
  </head>
  <body>
    <h1>Gde da izgradimo grad?</h1>
    <p class="description">
      Ovaj alat omogućava učenicima da izaberu prirodne oblasti na interaktivnoj
      mapi i saznaju kako te oblasti utiču na razvoj grada i dostupne resurse.
      Svaka oblast je jasno definisana kao zaseban oblik sa sopstvenom bojom i
      tekstualnim objašnjenjem.
    </p>

    <div id="container">
      <div id="mapArea" aria-label="Interaktivna mapa">
        <svg
          viewBox="0 0 600 400"
          role="img"
          aria-labelledby="mapTitle"
          xmlns="http://www.w3.org/2000/svg"
        >
          <title id="mapTitle">
            Jednostavna mapa sa rekom, planinom i šumom
          </title>

          <!-- Plava oblast - reka -->
          <path
            id="area-river"
            class="area"
            fill="url(#riverGradient)"
            stroke="#1a75ff"
            stroke-width="3"
            d="M 100 320 Q 150 280 200 300 T 300 280 Q 350 260 400 280 T 500 250 L 500 350 L 100 350 Z"
            tabindex="0"
            aria-describedby="desc-river"
          />
          <desc id="desc-river">Plava oblast predstavlja reku</desc>

          <!-- Siva oblast - planina -->
          <path
            id="area-mountain"
            class="area"
            fill="#9ea1a3"
            stroke="#65686b"
            stroke-width="3"
            d="M 70 150 L 140 70 L 180 120 L 230 50 L 280 130 L 320 90 L 370 140 L 410 80 L 460 140 L 490 110 L 520 170 L 70 170 Z"
            tabindex="0"
            aria-describedby="desc-mountain"
          />
          <desc id="desc-mountain">
            Siva oblast predstavlja planinu sa trouglastim vrhovima
          </desc>

          <!-- Zelena oblast - šuma -->
          <path
            id="area-forest"
            class="area"
            fill="url(#forestTexture)"
            stroke="#267326"
            stroke-width="3"
            d="M 450 200 Q 490 230 520 210 T 560 250 L 560 350 L 450 350 Z"
            tabindex="0"
            aria-describedby="desc-forest"
          />
          <desc id="desc-forest">Zelena oblast predstavlja gustu šumu</desc>

          <!-- Definicije gradijenata i tekstura -->
          <defs>
            <linearGradient id="riverGradient" x1="0" y1="0" x2="0" y2="1">
              <stop offset="0%" stop-color="#4da6ff" stop-opacity="0.7" />
              <stop offset="100%" stop-color="#1a75ff" stop-opacity="0.9" />
            </linearGradient>
            <pattern
              id="forestTexture"
              patternUnits="userSpaceOnUse"
              width="20"
              height="20"
            >
              <rect width="20" height="20" fill="#2e8b2e" />
              <circle cx="10" cy="10" r="3" fill="#1f5f1f" />
              <circle cx="5" cy="15" r="2" fill="#196619" />
              <circle cx="15" cy="5" r="2" fill="#196619" />
            </pattern>
          </defs>
        </svg>
      </div>

      <div id="infoPanel" role="region" aria-live="polite" aria-atomic="true">
        <div class="text-content" id="infoText">
          Izaberi oblast da vidiš mogućnosti razvoja grada.
        </div>
        <button id="btnReset" aria-label="Izaberi drugu oblast">
          Izaberi drugu oblast
        </button>
      </div>
    </div>

    <script>
      (() => {
        const infoText = document.getElementById("infoText");
        const btnReset = document.getElementById("btnReset");
        const svg = document.querySelector("svg");
        const areas = {
          river: document.getElementById("area-river"),
          mountain: document.getElementById("area-mountain"),
          forest: document.getElementById("area-forest"),
        };

        // State for clicks count per area
        const clickCount = {
          river: 0,
          mountain: 0,
          forest: 0,
        };

        // Store inserted animation elements for cleanup
        let currentAnimations = [];

        // Helper to clear animations and reset map view
        function resetView() {
          // Reset info text
          infoText.textContent =
            "Izaberi oblast da vidiš mogućnosti razvoja grada.";
          // Reset click counts
          for (let key in clickCount) clickCount[key] = 0;
          // Remove animation elements
          currentAnimations.forEach((elem) => {
            if (elem.parentNode) elem.parentNode.removeChild(elem);
          });
          currentAnimations = [];
          // Reset SVG viewBox to full map
          svg.setAttribute("viewBox", "0 0 600 400");
          // Reset all areas fill opacity & stroke width
          Object.values(areas).forEach((area) => {
            area.style.fillOpacity = "";
            area.style.strokeWidth = "3";
            area.style.pointerEvents = "auto";
          });
          btnReset.style.display = "none";
        }

        // Zoom to bounding box helper
        function zoomToBBox(bbox, padding = 20) {
          let x = bbox.x - padding;
          let y = bbox.y - padding;
          let w = bbox.width + padding * 2;
          let h = bbox.height + padding * 2;
          // Clamp values to SVG boundaries
          if (x < 0) x = 0;
          if (y < 0) y = 0;
          if (x + w > 600) w = 600 - x;
          if (y + h > 400) h = 400 - y;
          svg.setAttribute("viewBox", `${x} ${y} ${w} ${h}`);
        }

        // Create boat icon SVG element
        function createBoat(x, y) {
          const ns = "http://www.w3.org/2000/svg";
          const group = document.createElementNS(ns, "g");
          group.setAttribute("class", "boat");
          group.setAttribute("transform", `translate(${x},${y}) scale(0.6)`);
          group.setAttribute("aria-label", "Animirana ikona broda");
          group.setAttribute("role", "img");

          const hull = document.createElementNS(ns, "path");
          hull.setAttribute("d", "M0 15 L40 15 L35 30 L5 30 Z");
          hull.setAttribute("fill", "#6b4f4f");
          group.appendChild(hull);

          const mast = document.createElementNS(ns, "rect");
          mast.setAttribute("x", "18");
          mast.setAttribute("y", "-15");
          mast.setAttribute("width", "4");
          mast.setAttribute("height", "25");
          mast.setAttribute("fill", "#4a2e2e");
          group.appendChild(mast);

          const sail = document.createElementNS(ns, "polygon");
          sail.setAttribute("points", "20,-15 40,5 20,5");
          sail.setAttribute("fill", "#e8f0f7");
          group.appendChild(sail);

          return group;
        }

        // Create smoke animation icon
        function createSmoke(x, y) {
          const ns = "http://www.w3.org/2000/svg";
          const group = document.createElementNS(ns, "g");
          group.setAttribute("class", "smoke");
          group.setAttribute("transform", `translate(${x},${y})`);
          group.setAttribute("aria-label", "Animirani dim iz rudnika");
          group.setAttribute("role", "img");

          for (let i = 0; i < 3; i++) {
            const circle = document.createElementNS(ns, "circle");
            circle.setAttribute("cx", i * 10);
            circle.setAttribute("cy", 0);
            circle.setAttribute("r", 6 - i * 2);
            circle.setAttribute("fill", "rgba(120,120,120,0.6)");
            circle.style.animationDelay = `${i * 1}s`;
            group.appendChild(circle);
          }
          return group;
        }

        // Create lumberjack animation icon
        function createLumberjack(x, y) {
          const ns = "http://www.w3.org/2000/svg";
          const group = document.createElementNS(ns, "g");
          group.setAttribute("aria-label", "Animirani drvoseča");
          group.setAttribute("role", "img");
          group.setAttribute("transform", `translate(${x},${y}) scale(0.8)`);

          // Body
          const body = document.createElementNS(ns, "rect");
          body.setAttribute("x", "0");
          body.setAttribute("y", "10");
          body.setAttribute("width", "30");
          body.setAttribute("height", "40");
          body.setAttribute("fill", "#654321");
          group.appendChild(body);

          // Head
          const head = document.createElementNS(ns, "circle");
          head.setAttribute("cx", "15");
          head.setAttribute("cy", "10");
          head.setAttribute("r", "10");
          head.setAttribute("fill", "#f4c2a0");
          group.appendChild(head);

          // Left arm (static)
          const leftArm = document.createElementNS(ns, "rect");
          leftArm.setAttribute("x", "-10");
          leftArm.setAttribute("y", "20");
          leftArm.setAttribute("width", "10");
          leftArm.setAttribute("height", "8");
          leftArm.setAttribute("fill", "#8b4513");
          group.appendChild(leftArm);

          // Right arm (animated chopping)
          const rightArm = document.createElementNS(ns, "rect");
          rightArm.setAttribute("x", "20");
          rightArm.setAttribute("y", "30");
          rightArm.setAttribute("width", "15");
          rightArm.setAttribute("height", "6");
          rightArm.setAttribute("fill", "#8b4513");
          rightArm.setAttribute("class", "lumberjack-arm");
          group.appendChild(rightArm);

          // Axe
          const axeHandle = document.createElementNS(ns, "rect");
          axeHandle.setAttribute("x", "32");
          axeHandle.setAttribute("y", "30");
          axeHandle.setAttribute("width", "10");
          axeHandle.setAttribute("height", "3");
          axeHandle.setAttribute("fill", "#654321");
          group.appendChild(axeHandle);

          const axeHead = document.createElementNS(ns, "polygon");
          axeHead.setAttribute("points", "42,30 52,27 52,36 42,33");
          axeHead.setAttribute("fill", "#555555");
          group.appendChild(axeHead);

          return group;
        }

        // Interaction handlers
        function onRiverClick() {
          const c = ++clickCount.river;
          btnReset.style.display = "inline-block";
          // Zoom river area bbox
          zoomToBBox(areas.river.getBBox(), 30);
          if (c === 1) {
            clearAnimations();
            infoText.textContent =
              "Grad pored reke – razvijeno ribarstvo, transport i trgovina. Nedostatak: drvo i kamen.";
          } else {
            infoText.textContent =
              "Luka se razvija, ali nema dovoljno materijala za velike građevine.";
            addBoatAnimation();
          }
        }
        function addBoatAnimation() {
          clearAnimations();
          const bbox = areas.river.getBBox();
          const boat = createBoat(
            bbox.x + bbox.width / 2 - 20,
            bbox.y + bbox.height / 2 - 15
          );
          svg.appendChild(boat);
          currentAnimations.push(boat);
        }

        function onMountainClick() {
          const c = ++clickCount.mountain;
          btnReset.style.display = "inline-block";
          zoomToBBox(areas.mountain.getBBox(), 30);
          if (c === 1) {
            clearAnimations();
            infoText.textContent =
              "Planinski grad – dostupni su kamenolomi i rudnici. Nedostatak: voda i plodno zemljište.";
          } else {
            infoText.textContent =
              "Industrija raste, ali razvoj je ograničen usled nepovoljnih uslova za poljoprivredu.";
            addSmokeAnimation();
          }
        }
        function addSmokeAnimation() {
          clearAnimations();
          const bbox = areas.mountain.getBBox();
          // Place smoke near the upper center of mountain
          const smoke = createSmoke(
            bbox.x + bbox.width / 2 + 10,
            bbox.y + bbox.height / 4
          );
          svg.appendChild(smoke);
          currentAnimations.push(smoke);
        }

        function onForestClick() {
          const c = ++clickCount.forest;
          btnReset.style.display = "inline-block";
          zoomToBBox(areas.forest.getBBox(), 30);
          if (c === 1) {
            clearAnimations();
            infoText.textContent =
              "Šumski grad – dostupno drvo i lov, ali nedostaju kamen i trgovačke rute.";
          } else {
            infoText.textContent =
              "Grad raste sporo zbog loših veza sa ostalim oblastima.";
            addLumberjackAnimation();
          }
        }
        function addLumberjackAnimation() {
          clearAnimations();
          const bbox = areas.forest.getBBox();
          const lumberjack = createLumberjack(
            bbox.x + bbox.width / 2 - 15,
            bbox.y + bbox.height / 2 - 30
          );
          svg.appendChild(lumberjack);
          currentAnimations.push(lumberjack);
        }

        // Remove animation elements
        function clearAnimations() {
          currentAnimations.forEach((elem) => {
            if (elem.parentNode) elem.parentNode.removeChild(elem);
          });
          currentAnimations = [];
        }

        // Attach event listeners
        areas.river.addEventListener("click", onRiverClick);
        areas.mountain.addEventListener("click", onMountainClick);
        areas.forest.addEventListener("click", onForestClick);

        // Accessibility: allow keyboard activation (Enter or Space)
        Object.values(areas).forEach((area) => {
          area.addEventListener("keydown", (e) => {
            if (e.key === "Enter" || e.key === " ") {
              e.preventDefault();
              area.click();
            }
          });
        });

        btnReset.addEventListener("click", () => {
          resetView();
          btnReset.style.display = "none";
        });

        // Initial setup
        resetView();
      })();
    </script>
  </body>
</html>
