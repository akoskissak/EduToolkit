<!DOCTYPE html>
<html lang="hr">
<head>
<meta charset="utf-8" />
<title>Gde podići novi grad?</title>
<meta name="viewport" content="width=device-width,initial-scale=1" />
<style>
  /* audience: geografija, osnovna škola */
  :root{
    --panel-width:320px;
    --bg:#f2f6f8;
    --accent:#2b7cff;
    --map-width:calc(100% - var(--panel-width) - 40px);
  }
  html,body{height:100%;margin:0;font-family:Segoe UI,Roboto,Arial,sans-serif;background:var(--bg);color:#123;}
  header{padding:18px 20px 6px 20px;}
  h1{margin:0;font-size:26px;}
  p.description{margin:8px 0 16px 0;color:#234;padding-right:20px;}
  .container{display:flex;gap:20px;padding:0 20px 20px 20px;box-sizing:border-box;height:calc(100% - 110px);}
  .map-area{
    background:linear-gradient(180deg,#eaf3ff 0%, #f8feff 100%);
    border-radius:12px;
    box-shadow:0 6px 18px rgba(17,50,90,0.08);
    padding:18px;
    flex:1;
    min-width:300px;
    position:relative;
    overflow:hidden;
  }
  .instruction{
    font-weight:600;color:#074fb2;margin-bottom:10px;
  }
  .map-wrap{
    width:100%;
    height:100%;
    display:flex;
    align-items:center;
    justify-content:center;
    position:relative;
  }
  /* the map SVG container */
  #mapContainer{
    width:100%;
    height:520px;
    max-height:calc(100% - 60px);
    overflow:visible;
    display:block;
    position:relative;
    transform-origin: center center;
    transition: transform 600ms cubic-bezier(.2,.9,.25,1);
  }
  /* right panel */
  .panel{
    width:var(--panel-width);
    min-width:240px;
    background:white;
    border-radius:10px;
    padding:16px;
    box-shadow:0 6px 18px rgba(20,40,80,0.06);
    display:flex;
    flex-direction:column;
    gap:12px;
  }
  .panel h3{margin:0;font-size:16px;color:#0b3b74;}
  .panel .text{
    font-size:14px;color:#123;line-height:1.4;
    min-height:80px;padding-top:6px;
  }
  .controls{display:flex;gap:8px;align-items:center}
  button{
    background:linear-gradient(180deg,#2b7cff,#1263d9);
    border:0;color:white;padding:10px 12px;border-radius:8px;cursor:pointer;font-weight:600;
    box-shadow:0 4px 10px rgba(17,50,90,0.12);
  }
  button.reset{background:linear-gradient(180deg,#f2f2f2,#e0e0e0);color:#223;border:1px solid #d0d0d0;box-shadow:none}
  .hint{font-size:12px;color:#6a7b8f}
  /* clickable areas cursor */
  .clickable{cursor:pointer}
  .area-highlight{stroke:#ffb347;stroke-width:4;stroke-opacity:0.9;filter:drop-shadow(0 4px 12px rgba(0,0,0,0.15))}
  /* boat animation */
  .boat{
    width:44px;height:18px;
  }
  .boat.move{animation:boatMove 3200ms linear infinite}
  @keyframes boatMove{
    0%{transform:translateX(-10%) translateY(0) rotate(0deg)}
    50%{transform:translateX(60%) translateY(-6px) rotate(0deg)}
    100%{transform:translateX(130%) translateY(0) rotate(0deg)}
  }
  /* smoke */
  .smoke{opacity:0}
  .smoke.on{opacity:1}
  .smoke .puff{fill:rgba(150,150,150,0.7);animation:smokeRise 2200ms linear infinite}
  .smoke .puff:nth-child(2){animation-delay:400ms}
  .smoke .puff:nth-child(3){animation-delay:800ms}
  @keyframes smokeRise{
    0%{transform:translateY(0) scale(0.6);opacity:0.15}
    60%{transform:translateY(-24px) scale(1);opacity:0.6}
    100%{transform:translateY(-48px) scale(1.2);opacity:0}
  }
  /* lumberjack */
  .lumberjack{opacity:0;transform-origin:center;transition:opacity 360ms}
  .lumberjack.on{opacity:1}
  .axe{transform-origin:22px 6px}
  .axe.swing{animation:axeSwing 700ms ease-in-out infinite}
  @keyframes axeSwing{
    0%{transform:rotate(-12deg)}
    50%{transform:rotate(20deg)}
    100%{transform:rotate(-12deg)}
  }
  .tree.shake{animation:treeShake 700ms ease-in-out}
  @keyframes treeShake{
    0%{transform:rotate(0)}
    30%{transform:rotate(-8deg)}
    60%{transform:rotate(12deg)}
    100%{transform:rotate(0)}
  }
  /* small labels */
  .map-label{font-size:12px;fill:#072b4b;font-weight:700}
  /* responsive */
  @media (max-width:900px){
    .container{flex-direction:column}
    .panel{width:100%}
    #mapContainer{height:380px}
  }
</style>
</head>
<body>
<header>
  <h1>Gde podići novi grad?</h1>
  <p class="description">Ovaj interaktivni alat pomaže učenicima da istraže kako različiti prirodni predeli oblikuju razvoj gradova. Klikom na određenu oblast, prikazuju se objašnjenja i vizuelne animacije koje prikazuju dostupne resurse i prepreke za izgradnju grada.</p>
</header>

<div class="container">
  <div class="map-area" aria-label="Mapa - interaktivne oblasti">
    <div class="instruction">Klikni na oblast i otkrij kako ona utiče na razvoj grada</div>
    <div class="map-wrap">
      <!-- SVG map -->
      <svg id="mapContainer" viewBox="0 0 1000 600" preserveAspectRatio="xMidYMid meet">
        <defs>
          <linearGradient id="riverGrad" x1="0" x2="0" y1="0" y2="1">
            <stop offset="0%" stop-color="#78c7ff"/>
            <stop offset="100%" stop-color="#2b8fe8"/>
          </linearGradient>
          <linearGradient id="mountGrad" x1="0" x2="1" y1="0" y2="1">
            <stop offset="0%" stop-color="#d6d6d6"/>
            <stop offset="100%" stop-color="#9ea1a6"/>
          </linearGradient>
          <pattern id="treesPattern" patternUnits="userSpaceOnUse" width="20" height="20">
            <rect width="20" height="20" fill="#3ea13a"/>
            <g transform="translate(6,5)" fill="#2b7830">
              <circle cx="4" cy="6" r="4"/>
              <circle cx="10" cy="6" r="4"/>
              <rect x="8" y="8" width="4" height="6" fill="#6b3f2e"/>
            </g>
          </pattern>
          <filter id="softshadow" x="-50%" y="-50%" width="200%" height="200%">
            <feDropShadow dx="0" dy="6" stdDeviation="12" flood-color="#000" flood-opacity="0.12"/>
          </filter>
        </defs>

        <!-- Ground background -->
        <rect x="0" y="0" width="1000" height="600" fill="transparent"/>

        <!-- Mountain area (left) -->
        <g id="mountainGroup" class="clickable" transform="translate(60,30)">
          <path id="mountainArea" d="M0,360 L120,160 L200,300 L320,120 L420,340 L0,360 Z"
            fill="url(#mountGrad)" stroke="#7b7b7b" stroke-width="2" />
          <!-- peaks -->
          <polygon points="80,170 130,80 190,170" fill="#f2f2f2" opacity="0.6"/>
          <polygon points="260,130 310,40 360,130" fill="#f4f4f4" opacity="0.6"/>
          <text x="110" y="360" class="map-label">Planina</text>

          <!-- mine & smoke -->
          <g id="mine" transform="translate(180,290)">
            <rect x="-18" y="-6" width="38" height="20" fill="#4a3e34" stroke="#2b1f15" stroke-width="1"/>
            <rect x="-28" y="2" width="58" height="8" fill="#2f241c"/>
            <g id="smoke" class="smoke" transform="translate(10,-38)">
              <circle class="puff" cx="0" cy="0" r="8" />
              <circle class="puff" cx="14" cy="-6" r="7" />
              <circle class="puff" cx="-12" cy="-8" r="6" />
            </g>
          </g>
        </g>

        <!-- River area (bottom) -->
        <g id="riverGroup" class="clickable" transform="translate(80,160)">
          <path id="riverArea" d="M60,240 C220,320 420,320 580,260 C740,200 840,210 900,260 L900,360 L60,360 Z"
            fill="url(#riverGrad)" stroke="#1263d9" stroke-width="2" />
          <text x="380" y="330" class="map-label">Reka</text>

          <!-- boat container -->
          <g id="boatContainer" transform="translate(40,270)">
            <g id="boat" class="boat" transform="translate(0, -8)">
              <rect x="0" y="4" width="44" height="10" rx="3" fill="#6b3e20" />
              <polygon points="28,4 44,4 36,0 28,4" fill="#f6c86d"/>
              <rect x="16" y="-8" width="4" height="12" fill="#5a3926" />
              <rect x="20" y="-14" width="12" height="6" fill="#d8d8d8" rx="2"/>
            </g>
          </g>
        </g>

        <!-- Forest area (right) -->
        <g id="forestGroup" class="clickable" transform="translate(520,40)">
          <path id="forestArea" d="M0,160 C40,80 140,40 240,60 C300,72 360,40 420,110 C460,150 480,220 380,260 C320,290 220,310 120,280 C40,260 0,200 0,160 Z"
            fill="url(#treesPattern)" stroke="#2b7830" stroke-width="2" />
          <text x="220" y="120" class="map-label">Šuma</text>

          <!-- tree icons -->
          <g id="treeIcons" transform="translate(180,160) scale(0.9)">
            <g id="tree1" transform="translate(10,36)">
              <circle cx="0" cy="0" r="14" fill="#2b7830"/>
              <rect x="-4" y="10" width="8" height="14" fill="#6b3f2e"/>
            </g>
            <g id="tree2" transform="translate(60,14)">
              <circle cx="0" cy="0" r="16" fill="#2b6f2a"/>
              <rect x="-5" y="12" width="10" height="14" fill="#6b3f2e"/>
            </g>
          </g>

          <!-- lumberjack -->
          <g id="lumberjack" class="lumberjack" transform="translate(300,200)">
            <g transform="translate(-12,-6)">
              <rect x="-6" y="8" width="12" height="20" fill="#7a4a2d" rx="2"/>
              <circle cx="0" cy="0" r="8" fill="#ffc9a3"/>
              <g class="axe" transform="translate(18,6) rotate(-12)">
                <rect x="0" y="0" width="6" height="28" rx="2" fill="#6b3f2e"/>
                <rect x="-8" y="-4" width="18" height="10" rx="2" fill="#c3c3c3"/>
              </g>
            </g>
            <!-- tree that will be shaken -->
            <g id="targetTree" transform="translate(-30,30)">
              <circle cx="0" cy="-6" r="14" fill="#2b7830"/>
              <rect x="-4" y="6" width="8" height="16" fill="#6b3f2e"/>
            </g>
            <g id="stump" transform="translate(-30,30)" opacity="0">
              <rect x="-6" y="10" width="12" height="8" fill="#6b3f2e" rx="2"/>
            </g>
          </g>

        </g>

      </svg>
    </div>
  </div>

  <aside class="panel" aria-label="Informacioni panel">
    <h3>Informacije o oblasti</h3>
    <div class="text" id="infoText">Izaberi oblast na mapi da vidiš prednosti i nedostatke za razvoj grada.</div>
    <div class="controls">
      <button id="resetBtn" class="reset">Povratak na mapu</button>
      <div style="flex:1"></div>
    </div>
    <div class="hint">Klik na oblast takođe zumira mapu na tu regiju.</div>
  </aside>
</div>

<script>
(function(){
  // Elements
  const mapContainer = document.getElementById('mapContainer');
  const mountainGroup = document.getElementById('mountainGroup');
  const riverGroup = document.getElementById('riverGroup');
  const forestGroup = document.getElementById('forestGroup');
  const infoText = document.getElementById('infoText');
  const resetBtn = document.getElementById('resetBtn');

  const boat = document.getElementById('boat');
  const smoke = document.getElementById('smoke');
  const lumberjack = document.getElementById('lumberjack');
  const targetTree = document.getElementById('targetTree');
  const stump = document.getElementById('stump');

  // click counters
  const clicks = { mountain:0, river:0, forest:0 };

  // Interaction definitions (based on JSON)
  const interactions = {
    river: {
      then_first: "Grad uz reku pruža mogućnosti za ribolov, trgovinu i transport. Nedostatak: nema dovoljno drveta i kamena za gradnju.",
      then_next: [
        "Luka se širi, ali izgradnja velikih objekata je ograničena zbog manjka materijala."
      ]
    },
    mountain: {
      then_first: "Planinski grad ima kamenolome i rudnike. Nedostatak: nedovoljno vode i plodnog zemljišta.",
      then_next: [
        "Industrija napreduje, ali poljoprivreda je otežana zbog terena i klime."
      ]
    },
    forest: {
      then_first: "Šumski grad ima obilje drveta i mogućnost lova, ali nema kamen i dobre trgovačke puteve.",
      then_next: [
        "Grad raste sporo jer je slabo povezan sa ostalim oblastima."
      ]
    }
  };

  // Helper: show info text in panel
  function setInfo(text){
    infoText.textContent = text;
  }

  // Helper: transform (zoom) map to element
  function zoomToElement(elemGroup, scale=1.7){
    // compute BBox of element in SVG coordinates
    const bbox = elemGroup.getBBox();
    // center of bbox
    const cx = bbox.x + bbox.width/2;
    const cy = bbox.y + bbox.height/2;
    // get SVG size in pixels
    const svgRect = mapContainer.getBoundingClientRect();
    // current viewBox is 1000x600
    const viewW = 1000;
    const viewH = 600;
    // compute target translate to center element
    // desired: translate so that (cx,cy) moves to center of SVG (viewW/2, viewH/2) after scaling
    const tx = (viewW/2) - cx * scale;
    const ty = (viewH/2) - cy * scale;
    // apply transform (use CSS transform on outer SVG element)
    mapContainer.style.transform = `translate(${tx}px, ${ty}px) scale(${scale})`;
  }

  function resetView(){
    mapContainer.style.transform = '';
    // stop animations
    stopBoat();
    stopSmoke();
    stopLumber();
    // clear highlights
    clearHighlights();
    setInfo("Izaberi oblast na mapi da vidiš prednosti i nedostatke za razvoj grada.");
    // reset counters
    clicks.mountain = clicks.river = clicks.forest = 0;
  }

  function clearHighlights(){
    document.querySelectorAll('.area-highlight').forEach(el => el.classList.remove('area-highlight'));
  }

  // RIVER behaviors
  function handleRiverClick(){
    clicks.river++;
    clearHighlights();
    document.getElementById('riverArea').classList.add('area-highlight');
    if(clicks.river === 1){
      // first
      setInfo(interactions.river.then_first);
      // zoom
      zoomToElement(riverGroup, 1.9);
    } else {
      // subsequent - get next in sequence based on count (index = clicks-2 modulo length)
      const idx = Math.min(clicks.river - 2, interactions.river.then_next.length - 1);
      setInfo(interactions.river.then_next[idx]);
      // start boat animation
      startBoat();
      // keep zoomed
      zoomToElement(riverGroup, 1.9);
    }
  }

  function startBoat(){
    // make boat visible and add animation class
    boat.classList.add('move');
  }
  function stopBoat(){
    boat.classList.remove('move');
    // reset transform to initial position
    boat.style.transform = '';
  }

  // MOUNTAIN behaviors
  function handleMountainClick(){
    clicks.mountain++;
    clearHighlights();
    document.getElementById('mountainArea').classList.add('area-highlight');
    if(clicks.mountain === 1){
      setInfo(interactions.mountain.then_first);
      zoomToElement(mountainGroup, 1.7);
    } else {
      const idx = Math.min(clicks.mountain - 2, interactions.mountain.then_next.length - 1);
      setInfo(interactions.mountain.then_next[idx]);
      startSmoke();
      zoomToElement(mountainGroup, 1.7);
    }
  }

  function startSmoke(){
    smoke.classList.add('on');
    smoke.classList.add('smoking');
    // add stroke to mine to make it pop
    // (no need)
  }
  function stopSmoke(){
    smoke.classList.remove('on');
  }

  // FOREST behaviors
  function handleForestClick(){
    clicks.forest++;
    clearHighlights();
    document.getElementById('forestArea').classList.add('area-highlight');
    if(clicks.forest === 1){
      setInfo(interactions.forest.then_first);
      zoomToElement(forestGroup, 1.7);
    } else {
      const idx = Math.min(clicks.forest - 2, interactions.forest.then_next.length - 1);
      setInfo(interactions.forest.then_next[idx]);
      startLumber();
      zoomToElement(forestGroup, 1.7);
    }
  }

  function startLumber(){
    // show lumberjack and animate axe and tree
    lumberjack.classList.add('on');
    // swing the axe
    const axe = lumberjack.querySelector('.axe');
    axe.classList.add('swing');
    // shake tree
    targetTree.classList.add('shake');
    // after a short interval, hide tree and show stump
    setTimeout(()=>{
      targetTree.style.opacity = 0;
      stump.style.opacity = 1;
      targetTree.classList.remove('shake');
      axe.classList.remove('swing');
    }, 1200);
  }
  function stopLumber(){
    lumberjack.classList.remove('on');
    const axe = lumberjack.querySelector('.axe');
    axe.classList.remove('swing');
    targetTree.style.opacity = 1;
    stump.style.opacity = 0;
    targetTree.classList.remove('shake');
  }

  // attach click handlers
  riverGroup.addEventListener('click', function(e){
    e.stopPropagation();
    handleRiverClick();
  });
  mountainGroup.addEventListener('click', function(e){
    e.stopPropagation();
    handleMountainClick();
  });
  forestGroup.addEventListener('click', function(e){
    e.stopPropagation();
    handleForestClick();
  });

  // clicking outside resets highlight but doesn't reset full view
  mapContainer.addEventListener('click', function(e){ /* ignore background clicks */ });

  // reset button
  resetBtn.addEventListener('click', function(){
    resetView();
  });

  // Initialize: set initial styles per JSON "initial" text mapping (already visually represented)
  // Make groups keyboard-focusable
  [mountainGroup, riverGroup, forestGroup].forEach(g=>{
    g.setAttribute('tabindex','0');
    g.addEventListener('keydown', function(ev){
      if(ev.key === 'Enter' || ev.key === ' '){
        ev.preventDefault();
        g.dispatchEvent(new MouseEvent('click', {bubbles:true, cancelable:true}));
      }
    });
  });

  // On load ensure initial state: hide animations
  resetView();

  // Small accessibility: pointer cursor on clickable elements
  ['mountainArea','riverArea','forestArea'].forEach(id=>{
    const el = document.getElementById(id);
    if(el) el.style.cursor='pointer';
  });

})();
</script>
</body>
</html>