<html lang="sr"><head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Interaktivno iscrtavanje trigonometrijske funkcije</title>
<style>
  /* audience: srednjoškolci */
  :root{
    --bg:#f7f9fc;
    --card:#ffffff;
    --muted:#556;
    --accent:#2b7be4;
    --grid:#d7e6fb;
    --axis:#334155;
    --text:#0f1724;
  }
  html,body{height:100%;margin:0;padding:16px;font-family:Inter, Roboto, Arial, sans-serif;background:var(--bg);color:var(--text);}
  h1{margin:0 0 8px 0;font-size:1.6rem;color:var(--accent);}
  p.description{margin:0 0 18px 0;color:var(--muted);max-width:900px;}
  .container{max-width:1000px;margin:0 auto;}
  .card{background:var(--card);box-shadow:0 6px 18px rgba(18,38,63,0.06);border-radius:10px;padding:16px;}
  .canvas-wrap{display:flex;flex-direction:column;gap:12px;}
  canvas{background:linear-gradient(180deg,#fbfdff, #f4f9ff);border-radius:8px;border:1px solid #e2eefc;display:block;width:100%;height:420px;}
  .controls{display:flex;flex-direction:column;gap:12px;padding-top:6px;}
  .slider-row{display:flex;gap:12px;align-items:center;}
  .slider-label{width:110px;font-weight:600;color:var(--muted);font-size:0.95rem;}
  .slider{flex:1;display:flex;align-items:center;gap:12px;}
  input[type=range]{width:100%;}
  .val{width:86px;text-align:right;color:var(--accent);font-weight:700;}
  .info{margin-top:8px;padding:10px;border-radius:8px;background:linear-gradient(180deg,#ffffff,#f8fbff);border:1px solid #e6f0ff;color:#0b2a66;font-size:0.95rem;display:flex;flex-direction:column;gap:6px;}
  .equation{font-family:monospace;background:#f1f7ff;padding:6px 8px;border-radius:6px;border:1px dashed #d7e8ff;color:#08306b;display:inline-block;}
  .msg{font-size:0.9rem;color:#093061;}
  .small{font-size:0.85rem;color:var(--muted);}
  .row{display:flex;gap:12px;align-items:center;flex-wrap:wrap;}
  .btn{background:var(--accent);color:#fff;padding:8px 12px;border-radius:8px;border:none;cursor:pointer;font-weight:600;}
  .legend{display:flex;gap:12px;align-items:center;}
  .swatch{width:14px;height:14px;border-radius:4px;background:#e02424;box-shadow:0 1px 2px rgba(224,36,36,0.35);}
  @media (max-width:720px){
    canvas{height:320px;}
    .slider-label{width:96px;}
  }
</style>
</head>
<body>
<div class="container">
  <h1>Interaktivno iscrtavanje trigonometrijske funkcije</h1>
  <p class="description">Ovaj interaktivni alat omogućava učenicima da vizuelno istraže trigonometrijske funkcije. Korisnik može menjati parametre funkcije (amplitudu, frekvenciju i fazni pomeraj), a graf se automatski osvežava. Na taj način učenici bolje razumeju kako promene parametara utiču na oblik funkcije.</p>

  <div class="card">
    <div class="canvas-wrap">
      <canvas id="plot" width="920" height="420" style="width: 760px; height: 420px;"></canvas>
      <div class="row" style="justify-content:space-between;align-items:center;">
        <div class="legend">
          <div class="swatch"></div>
          <div style="font-weight:700;color:var(--muted)">y = A · sin(B·x + C)</div>
          <div style="margin-left:8px;" class="small">(crveno: funkcija, mreža i osovine pomažu u interpretaciji)</div>
        </div>
        <div class="small">Opseg x: -2π ... 2π , y: -3 ... 3</div>
      </div>
    </div>

    <div class="controls">
      <!-- Amplituda -->
      <div class="slider-row">
        <div class="slider-label">Amplituda (A)</div>
        <div class="slider">
          <input id="amp" type="range" min="0" max="3" step="0.01" value="1">
          <div class="val" id="ampVal">1.00</div>
        </div>
      </div>

      <!-- Frekvencija -->
      <div class="slider-row">
        <div class="slider-label">Frekvencija (B)</div>
        <div class="slider">
          <input id="freq" type="range" min="0.1" max="5" step="0.01" value="1">
          <div class="val" id="freqVal">1.00</div>
        </div>
      </div>

      <!-- Fazni pomeraj -->
      <div class="slider-row">
        <div class="slider-label">Fazni pomeraj (C)</div>
        <div class="slider">
          <input id="phase" type="range" min="-3.1416" max="3.1416" step="0.01" value="0">
          <div class="val" id="phaseVal">0.00</div>
        </div>
      </div>

      <div class="info">
        <div class="msg" id="status">Resetovano: vraćeni parametri su A=1, B=1, C=0. Početno stanje: y = sin(x).</div>
        <div class="small">Poruka o interakciji se menja: prvi put kad pomerite svaki klizač dobićete objašnjenje prvog efekta (THEN_FIRST), a svaki naredni put drugačiji opis (THEN_NEXT).</div>
        <div style="display:flex;justify-content:space-between;align-items:center;margin-top:6px;">
          <div class="equation" id="equation">y = 1.00 · sin(1.00·x + 0.00)</div>
          <div style="display:flex;gap:8px;">
            <button class="btn" id="resetBtn">Resetuj</button>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
/*
  audience: srednjoškolci
  Implementira: inicialno y = sin(x) (A=1, B=1, C=0)
  Interactions:
  - pomeranje klizača Amplituda: then_first, then_next...
  - Frekvencija ...
  - Fazni pomeraj ...
  Extras: glatka animacija prilikom prelaska grafa
*/

(() => {
  const canvas = document.getElementById('plot');
  const ctx = canvas.getContext('2d');
  // Logical drawing parameters
  const W = canvas.width;
  const H = canvas.height;

  // Math domain and range
  const xMin = -Math.PI * 2;
  const xMax = Math.PI * 2;
  const yMin = -3;
  const yMax = 3;

  // UI elements
  const ampRange = document.getElementById('amp');
  const freqRange = document.getElementById('freq');
  const phaseRange = document.getElementById('phase');
  const ampVal = document.getElementById('ampVal');
  const freqVal = document.getElementById('freqVal');
  const phaseVal = document.getElementById('phaseVal');
  const status = document.getElementById('status');
  const eq = document.getElementById('equation');
  const resetBtn = document.getElementById('resetBtn');

  // Interaction counters to detect first vs next
  const clickCounts = {
    amp: 0,
    freq: 0,
    phase: 0
  };

  // THEN_FIRST and THEN_NEXT phrases from input JSON (Serbian)
  const messages = {
    amp: {
      first: "Graf se ponovo iscrta sa novom amplitudom (y = A * sin(x)).",
      next: "Funkcija postaje viša ili niža u zavisnosti od vrednosti."
    },
    freq: {
      first: "Graf se ponovo iscrta sa novom frekvencijom (y = sin(B * x)).",
      next: "Talasi se zgušnjavaju ili razređuju na x-osi."
    },
    phase: {
      first: "Graf se pomera ulevo ili udesno (y = sin(x + C)).",
      next: "Funkcija se horizontalno translira."
    }
  };

  // Animation state: current params and target params
  let current = { A: 1, B: 1, C: 0 };
  let target = { A: 1, B: 1, C: 0 };
  let anim = null; // {start:..., duration:..., from:..., to:...}

  // Drawing helpers: convert math coord to pixel
  function xToPx(x){
    return ( (x - xMin) / (xMax - xMin) ) * W;
  }
  function yToPx(y){
    return H - ( (y - yMin) / (yMax - yMin) ) * H;
  }

  // Draw grid and axes
  function drawGrid(){
    ctx.clearRect(0,0,W,H);
    // grid every pi/2 on x, and every 0.5 on y
    ctx.lineWidth = 1;
    // vertical grid
    ctx.strokeStyle = "#eaf3ff";
    ctx.beginPath();
    for(let k = -4; k <= 4; k++){
      const x = k * Math.PI / 2;
      const px = xToPx(x);
      ctx.moveTo(px,0);
      ctx.lineTo(px,H);
    }
    ctx.stroke();
    // horizontal grid
    ctx.beginPath();
    for(let y = Math.ceil(yMin*2)/2; y <= yMax; y += 0.5){
      const py = yToPx(y);
      ctx.moveTo(0,py);
      ctx.lineTo(W,py);
    }
    ctx.stroke();

    // axes
    ctx.lineWidth = 1.8;
    ctx.strokeStyle = "#274060";
    ctx.beginPath();
    // x-axis (y=0)
    const y0 = yToPx(0);
    ctx.moveTo(0,y0);
    ctx.lineTo(W,y0);
    // y-axis (x=0)
    const x0 = xToPx(0);
    ctx.moveTo(x0,0);
    ctx.lineTo(x0,H);
    ctx.stroke();

    // tick labels on x: multiples of pi/2 with nice labels
    ctx.fillStyle = "#22334a";
    ctx.font = "12px system-ui, Arial";
    ctx.textAlign = "center";
    ctx.textBaseline = "top";
    for(let k = -2; k <= 2; k++){
      // label -2π ... 2π at step π/2 give visible ticks
    }
    // draw labeled ticks at -2π, -π, -π/2, 0, π/2, π, 2π
    const ticks = [-2*Math.PI, -Math.PI, -Math.PI/2, 0, Math.PI/2, Math.PI, 2*Math.PI];
    const labels = ["-2π","-π","-π/2","0","π/2","π","2π"];
    for(let i=0;i<ticks.length;i++){
      const px = xToPx(ticks[i]);
      const py = y0;
      ctx.beginPath();
      ctx.strokeStyle = "#aac8ff";
      ctx.moveTo(px,py-6);
      ctx.lineTo(px,py+6);
      ctx.stroke();
      ctx.fillStyle = "#0f1f38";
      ctx.fillText(labels[i], px, py+8);
    }

    // y ticks and labels
    ctx.textAlign = "right";
    ctx.textBaseline = "middle";
    for(let y = -3; y <= 3; y++){
      const py = yToPx(y);
      ctx.beginPath();
      ctx.strokeStyle = "#e6f1ff";
      ctx.moveTo(0,py);
      ctx.lineTo(W,py);
      ctx.stroke();
      if(y !== 0){
        ctx.fillStyle = "#0f1f38";
        ctx.fillText(y.toFixed(0), x0-8, py);
      }
    }
  }

  // draw function given params
  function drawFunction(params){
    const A = params.A, B = params.B, C = params.C;
    ctx.lineWidth = 3;
    ctx.strokeStyle = "#e02424";
    ctx.beginPath();
    const samples = Math.max(600, Math.floor(W*1.5));
    for(let i=0;i<=samples;i++){
      const t = i / samples;
      const x = xMin + t*(xMax - xMin);
      const y = A * Math.sin(B * x + C);
      const px = xToPx(x);
      const py = yToPx(y);
      if(i===0) ctx.moveTo(px,py);
      else ctx.lineTo(px,py);
    }
    ctx.stroke();

    // Draw a translucent area under curve (optional visual aid)
    ctx.globalAlpha = 0.06;
    ctx.fillStyle = "#e02424";
    ctx.beginPath();
    for(let i=0;i<=samples;i++){
      const t = i / samples;
      const x = xMin + t*(xMax - xMin);
      const y = A * Math.sin(B * x + C);
      const px = xToPx(x);
      const py = yToPx(y);
      if(i===0) ctx.moveTo(px,py);
      else ctx.lineTo(px,py);
    }
    // close to bottom of canvas
    ctx.lineTo(W, H);
    ctx.lineTo(0, H);
    ctx.closePath();
    ctx.fill();
    ctx.globalAlpha = 1.0;

    // draw a few highlighted points to emphasize amplitude
    ctx.fillStyle = "#7a0d0d";
    for(let k=-2;k<=2;k++){
      const x = k * Math.PI/2;
      const y = A * Math.sin(B * x + C);
      ctx.beginPath();
      ctx.arc(xToPx(x), yToPx(y), 3.5, 0, Math.PI*2);
      ctx.fill();
    }
  }

  // entire rendering
  function render(params){
    drawGrid();
    drawFunction(params);
  }

  // easing
  function easeOutCubic(t){ return 1 - Math.pow(1 - t, 3); }

  // start animation from current to target
  function animateTo(newTarget){
    // set up animation
    const duration = 600; // ms
    if(anim) cancelAnimationFrame(anim.raf);
    const start = performance.now();
    const from = {...current};
    const to = {...newTarget};
    anim = {start, duration, from, to, raf: null};
    function step(now){
      const elapsed = now - start;
      let t = Math.min(1, elapsed / duration);
      t = easeOutCubic(t);
      current.A = from.A + (to.A - from.A) * t;
      current.B = from.B + (to.B - from.B) * t;
      current.C = from.C + (to.C - from.C) * t;
      render(current);
      if(elapsed < duration){
        anim.raf = requestAnimationFrame(step);
      } else {
        current = {...to};
        anim = null;
      }
    }
    anim.raf = requestAnimationFrame(step);
  }

  // Update UI displays
  function updateUI(){
    ampVal.textContent = Number(target.A).toFixed(2);
    freqVal.textContent = Number(target.B).toFixed(2);
    phaseVal.textContent = Number(target.C).toFixed(2);
    eq.textContent = `y = ${Number(target.A).toFixed(2)} · sin(${Number(target.B).toFixed(2)}·x + ${Number(target.C).toFixed(2)})`;
  }

  // Handler for slider events with click count logic
  function handleSliderChange(kind, newValue){
    // newValue already numeric
    // increment click count (first time move triggers then_first)
    clickCounts[kind] = (clickCounts[kind] || 0) + 1;
    // choose message
    let msg;
    if(clickCounts[kind] === 1) msg = messages[kind].first;
    else msg = messages[kind].next;
    // set status compose with details
    const A = (kind === 'amp') ? newValue : target.A;
    const B = (kind === 'freq') ? newValue : target.B;
    const C = (kind === 'phase') ? newValue : target.C;
    status.textContent = `${msg} Trenutna jednačina: y = ${A === undefined ? target.A : Number(A).toFixed(2)} · sin(${B === undefined ? target.B : Number(B).toFixed(2)}·x + ${C === undefined ? target.C : Number(C).toFixed(2)}).`;
    // update target and start animation
    target = {...target, [ kind === 'amp' ? 'A' : kind === 'freq' ? 'B' : 'C' ]: newValue};
    updateUI();
    animateTo(target);
  }

  // wire up events
  ampRange.addEventListener('input', (e) => {
    const val = parseFloat(e.target.value);
    ampVal.textContent = val.toFixed(2);
    handleSliderChange('amp', val);
  });
  freqRange.addEventListener('input', (e) => {
    const val = parseFloat(e.target.value);
    freqVal.textContent = val.toFixed(2);
    handleSliderChange('freq', val);
  });
  phaseRange.addEventListener('input', (e) => {
    const val = parseFloat(e.target.value);
    phaseVal.textContent = val.toFixed(2);
    handleSliderChange('phase', val);
  });

  // Reset button
  resetBtn.addEventListener('click', () => {
    ampRange.value = 1; freqRange.value = 1; phaseRange.value = 0;
    ampVal.textContent = "1.00"; freqVal.textContent = "1.00"; phaseVal.textContent = "0.00";
    clickCounts.amp = 0; clickCounts.freq = 0; clickCounts.phase = 0;
    target = {A:1,B:1,C:0};
    status.textContent = "Resetovano: vraćeni parametri su A=1, B=1, C=0. Početno stanje: y = sin(x).";
    updateUI();
    animateTo(target);
  });

  // initial render
  updateUI();
  render(current);

  // Resize handling to keep canvas crisp on different DPRs
  function resizeCanvas(){
    const dpr = window.devicePixelRatio || 1;
    const rect = canvas.getBoundingClientRect();
    const w = Math.max(600, Math.floor(rect.width));
    const h = Math.floor(rect.height);
    if(canvas.width !== Math.floor(w * dpr) || canvas.height !== Math.floor(h * dpr)){
      canvas.width = Math.floor(w * dpr);
      canvas.height = Math.floor(h * dpr);
      canvas.style.width = w + "px";
      canvas.style.height = h + "px";
      ctx.setTransform(dpr,0,0,dpr,0,0);
      render(current);
    }
  }
  // initial fix: set canvas style width matching internal W,H defined earlier
  (function initSize(){
    // keep the original logical size but make scaling responsive
    const rect = canvas.getBoundingClientRect();
    canvas.style.width = Math.min(920, rect.width) + "px";
    canvas.style.height = "420px";
    // adjust actual resolution for DPR
    const dpr = window.devicePixelRatio || 1;
    canvas.width = 920 * dpr;
    canvas.height = 420 * dpr;
    ctx.setTransform(dpr,0,0,dpr,0,0);
    render(current);
  })();

  window.addEventListener('resize', () => {
    // keep simple: re-render on resize
    render(current);
  });

  // Accessibility: keyboard arrow keys adjust focused slider
  document.querySelectorAll('input[type=range]').forEach(input => {
    input.addEventListener('keydown', (e) => {
      if(e.key === 'ArrowLeft' || e.key === 'ArrowDown'){
        input.stepDown();
        input.dispatchEvent(new Event('input'));
        e.preventDefault();
      } else if(e.key === 'ArrowRight' || e.key === 'ArrowUp'){
        input.stepUp();
        input.dispatchEvent(new Event('input'));
        e.preventDefault();
      }
    });
  });

  // Inform initial guidance
  status.textContent = "Početno stanje: y = sin(x) (A=1, B=1, C=0). Pomerite klizače ispod da biste promenili graf. Prvo pomeranje svakog klizača prikazuje THEN_FIRST poruku, a naredna THEN_NEXT objašnjenja.";

})();
</script>

</body></html>