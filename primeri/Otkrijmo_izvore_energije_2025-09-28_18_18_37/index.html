<!DOCTYPE html>
<html lang="sr">
<head>
<meta charset="utf-8" />
<title>Otkrijmo izvore energije</title>
<style>
  :root{
    --bg:#eaf6ff;
    --ground:#d9f0d9;
    --panel:#0b6b8f;
    --panel-gloss:rgba(255,255,255,0.25);
    --turbine:#ffffff;
    --turbine-accent:#cfd8dc;
    --water:#4da6ff;
    --arrow:#ff9f1c;
    --city:#f4a261;
    --text-bg:rgba(0,0,0,0.6);
    --text-color:#fff;
  }
  html,body{height:100%;margin:0;font-family:Segoe UI, Roboto, Arial, sans-serif;background:linear-gradient(#eaf6ff, #ffffff);}
  .container{width:1000px;margin:20px auto; text-align:center;}
  h1{margin:10px 0 6px;}
  p.description{margin:6px 0 18px;color:#333;}
  .stage{background:linear-gradient(#cfeffd, #e6fbff); border-radius:8px; padding:12px; box-shadow:0 6px 18px rgba(10,30,60,0.08);}
  svg{width:100%; height:600px; overflow:visible; display:block; margin:0 auto; user-select:none;}
  .clickable{cursor:pointer;}
  .info-panel{font-size:14px; fill:var(--text-color); pointer-events:none;}
  .info-bg{fill:var(--text-bg); rx:6; ry:6;}
  .reset-row{display:flex; justify-content:space-between; align-items:center; margin-top:8px;}
  button#resetBtn{padding:8px 12px;border-radius:6px;border:none;background:#1976d2;color:#fff;cursor:pointer;font-weight:600;}
  button#resetBtn:hover{background:#115293;}
  .hint{color:#555; font-size:13px;}
  /* Initial subtle panel gloss */
  .panel-gloss{fill:var(--panel-gloss);}
  /* Turbine blade style */
  .blade{fill:var(--turbine-accent); stroke:#fff; stroke-width:0.5;}
  .nacelle{fill:#f5f5f5; stroke:#ddd;}
  /* animations */
  .spin { animation:spin 1s linear infinite; transform-origin: center; }
  @keyframes spin { from{transform:rotate(0deg);} to{transform:rotate(360deg);} }
  .rayPulse { animation:rayPulse 1.4s ease-in-out infinite; transform-origin: left center; }
  @keyframes rayPulse { 0% { opacity:0.15; transform:translateX(0) scaleX(0.9);} 50% {opacity:0.9; transform:translateX(6px) scaleX(1);} 100% {opacity:0.15; transform:translateX(0) scaleX(0.9);} }
  .waterFlow .drop { animation:flow 1s linear infinite; }
  @keyframes flow { 0%{transform:translateX(0);} 100%{transform:translateX(220px);} }
  .arrowPulse { animation:arrowPulse 0.9s ease-in-out infinite; }
  @keyframes arrowPulse { 0%{stroke-opacity:0.4; stroke-width:6;} 50%{stroke-opacity:1; stroke-width:10;} 100%{stroke-opacity:0.4; stroke-width:6;} }
  .city{fill:var(--city); stroke:#b5651d; stroke-width:1;}
  .hill{fill: #9ccaa7;}
  /* small shadow */
  .shadow{opacity:0.12; filter:blur(2px);}
  /* responsive-ish */
  @media (max-width:1050px){ .container{width:95%;} svg{height:520px;} }
</style>
<!-- audience: srednja škola, fizika -->
</head>
<body>
  <div class="container">
    <h1>Otkrijmo izvore energije</h1>
    <p class="description">Alat omogućava učenicima da klikom istraže solarne, vetrogeneratorske i hidroelektrane i vide kako proizvode energiju.</p>
    <div class="stage">
      <svg id="scene" viewBox="0 0 1000 600" xmlns="http://www.w3.org/2000/svg" aria-label="Interaktivna ilustracija izvora energije">
        <!-- Ground -->
        <rect x="0" y="420" width="1000" height="180" fill="url(#groundGrad)" />
        <defs>
          <linearGradient id="groundGrad" x1="0" x2="0" y1="0" y2="1">
            <stop offset="0%" stop-color="#d9f0d9" />
            <stop offset="100%" stop-color="#cbe8c9" />
          </linearGradient>
          <linearGradient id="sunGrad" x1="0" x2="1">
            <stop offset="0%" stop-color="#ffe082" />
            <stop offset="100%" stop-color="#ffd54f" />
          </linearGradient>
        </defs>

        <!-- Sun (left top) -->
        <g id="sun" transform="translate(110,90)">
          <circle cx="0" cy="0" r="36" fill="url(#sunGrad)" stroke="#ffecb3" stroke-width="2"/>
        </g>

        <!-- Solar panels group on left side -->
        <g id="solarGroup" class="clickable" transform="translate(50,300)" data-type="solar" aria-label="Solarni paneli">
          <!-- panels row -->
          <g id="solarPanels">
            <!-- three panels -->
            <rect x="0" y="-30" width="110" height="60" rx="6" fill="#083e57" stroke="#072b36" stroke-width="3"/>
            <rect x="6" y="-24" width="98" height="48" fill="url(#panelGrid)"/>
            <rect x="0" y="40" width="110" height="12" rx="3" fill="#4a2f1a"/>
            <g transform="translate(135,0)">
              <rect x="0" y="-30" width="110" height="60" rx="6" fill="#083e57" stroke="#072b36" stroke-width="3"/>
              <rect x="6" y="-24" width="98" height="48" fill="url(#panelGrid)"/>
              <rect x="0" y="40" width="110" height="12" rx="3" fill="#4a2f1a"/>
            </g>
            <g transform="translate(270,0)">
              <rect x="0" y="-30" width="110" height="60" rx="6" fill="#083e57" stroke="#072b36" stroke-width="3"/>
              <rect x="6" y="-24" width="98" height="48" fill="url(#panelGrid)"/>
              <rect x="0" y="40" width="110" height="12" rx="3" fill="#4a2f1a"/>
            </g>
          </g>
          <!-- subtle gloss to show reflective -->
          <g id="panelGloss" class="panel-gloss" opacity="0.45">
            <ellipse cx="165" cy="-6" rx="130" ry="40" transform="rotate(-12)" />
          </g>
          <!-- hidden animated rays (added later) -->
          <g id="sunRays" transform="translate(60,-60)" opacity="0">
            <g class="rays">
              <rect x="-14" y="-10" width="6" height="80" fill="#ffd54f" opacity="0.14" class="rayPulse"/>
              <rect x="6" y="-8" width="6" height="70" fill="#ffd54f" opacity="0.12" class="rayPulse"/>
              <rect x="26" y="-12" width="6" height="86" fill="#ffd54f" opacity="0.11" class="rayPulse"/>
            </g>
          </g>

          <!-- text panel below -->
          <g id="solarTextPanel" transform="translate(0,70)">
            <rect class="info-bg" width="360" height="46" />
            <text class="info-panel" x="12" y="28" id="solarText"></text>
          </g>
        </g>

        <!-- Middle: Cities -->
        <g id="cities" transform="translate(420,320)">
          <g class="cityGroup">
            <rect x="-90" y="-20" width="58" height="38" rx="4" class="city" />
            <rect x="-74" y="-34" width="12" height="16" fill="#fff" />
            <rect x="-54" y="-34" width="12" height="16" fill="#fff" />
          </g>
          <g class="cityGroup" transform="translate(120,0)">
            <rect x="-90" y="-20" width="58" height="38" rx="4" class="city" />
            <rect x="-74" y="-34" width="12" height="16" fill="#fff" />
            <rect x="-54" y="-34" width="12" height="16" fill="#fff" />
          </g>
          <text x="10" y="60" font-size="13" fill="#333">Gradovi</text>
        </g>

        <!-- Arrows showing energy flow -->
        <g id="arrows">
          <!-- Solar -> City arrow -->
          <g id="arrowSolar" class="clickable" data-type="arrow" transform="translate(200,270)">
            <path d="M-40,0 C30,0 120,0 210,0" stroke="var(--arrow)" stroke-width="6" fill="none" stroke-linecap="round" />
            <polygon points="210,0 200,-8 200,8" fill="var(--arrow)" />
          </g>
          <!-- Wind -> City arrow -->
          <g id="arrowWind" class="clickable" data-type="arrow" transform="translate(840,250)">
            <path d="M40,0 C-40,0 -160,0 -260,0" stroke="var(--arrow)" stroke-width="6" fill="none" stroke-linecap="round" />
            <polygon points="-260,0 -250,-8 -250,8" fill="var(--arrow)" />
          </g>
          <!-- Hydro -> City arrow -->
          <g id="arrowHydro" class="clickable" data-type="arrow" transform="translate(520,480)">
            <path d="M-40,0 C40,0 120,0 220,0" stroke="var(--arrow)" stroke-width="6" fill="none" stroke-linecap="round" />
            <polygon points="220,0 210,-8 210,8" fill="var(--arrow)" />
          </g>
        </g>

        <!-- Wind turbines on right hill -->
        <g id="windArea" transform="translate(770,250)" class="clickable" data-type="wind" aria-label="Vetroturbine">
          <!-- hill -->
          <path class="hill" d="M-220,160 Q-120,70 0,160 L-220,160" />
          <!-- three turbines -->
          <g transform="translate(-120,20)">
            <rect x="-10" y="30" width="20" height="70" fill="#dbe9ff" stroke="#c6d8ef"/>
            <g class="turbine" id="wind1" transform="translate(0,28)">
              <circle cx="0" cy="0" r="8" class="nacelle"/>
              <g class="blades" id="blades1">
                <path class="blade" d="M0,0 L40,-8 A2,2 0 0 1 40,8 Z" transform="rotate(0)"/>
                <path class="blade" d="M0,0 L-35,18 A2,2 0 0 1 -25,28 Z" transform="rotate(120)"/>
                <path class="blade" d="M0,0 L-35,-18 A2,2 0 0 1 -25,-28 Z" transform="rotate(240)"/>
              </g>
            </g>
          </g>
          <g transform="translate(0,0)">
            <rect x="-10" y="30" width="20" height="90" fill="#dbe9ff" stroke="#c6d8ef"/>
            <g class="turbine" id="wind2" transform="translate(0,28)">
              <circle cx="0" cy="0" r="8" class="nacelle"/>
              <g class="blades" id="blades2">
                <path class="blade" d="M0,0 L40,-8 A2,2 0 0 1 40,8 Z" transform="rotate(0)"/>
                <path class="blade" d="M0,0 L-35,18 A2,2 0 0 1 -25,28 Z" transform="rotate(120)"/>
                <path class="blade" d="M0,0 L-35,-18 A2,2 0 0 1 -25,-28 Z" transform="rotate(240)"/>
              </g>
            </g>
          </g>
          <g transform="translate(120,10)">
            <rect x="-10" y="30" width="20" height="80" fill="#dbe9ff" stroke="#c6d8ef"/>
            <g class="turbine" id="wind3" transform="translate(0,28)">
              <circle cx="0" cy="0" r="8" class="nacelle"/>
              <g class="blades" id="blades3">
                <path class="blade" d="M0,0 L40,-8 A2,2 0 0 1 40,8 Z" transform="rotate(0)"/>
                <path class="blade" d="M0,0 L-35,18 A2,2 0 0 1 -25,28 Z" transform="rotate(120)"/>
                <path class="blade" d="M0,0 L-35,-18 A2,2 0 0 1 -25,-28 Z" transform="rotate(240)"/>
              </g>
            </g>
          </g>

          <!-- text panel beside them -->
          <g id="windTextPanel" transform="translate(-120,130)">
            <rect class="info-bg" x="0" y="0" width="360" height="46" />
            <text class="info-panel" x="12" y="28" id="windText"></text>
          </g>
        </g>

        <!-- Hydro plant at bottom near river -->
        <g id="hydroArea" transform="translate(180,460)" class="clickable" data-type="hydro" aria-label="Hidroelektrana">
          <!-- river -->
          <rect x="300" y="-70" width="520" height="60" fill="#d6f0ff" rx="10" />
          <rect x="300" y="-70" width="520" height="40" fill="#eaf8ff" rx="10" />
          <!-- dam and turbine building -->
          <g id="dam" transform="translate(20,-10)">
            <rect x="0" y="-30" width="120" height="60" fill="#b0bec5" stroke="#90a4ae" rx="6"/>
            <rect x="12" y="-10" width="96" height="8" fill="#90a4ae" />
            <!-- turbine wheel -->
            <g id="hydroWheel" transform="translate(60,0)">
              <circle r="16" fill="#cfd8dc" stroke="#9ea7ab"/>
              <g id="hydroBlades">
                <path d="M0,0 L30,4 A2,2 0 0 1 30,-4 Z" class="blade"/>
                <path d="M0,0 L-20,24 A2,2 0 0 1 -10,34 Z" class="blade"/>
                <path d="M0,0 L-20,-24 A2,2 0 0 1 -10,-34 Z" class="blade"/>
              </g>
            </g>
          </g>

          <!-- animated water drops path (initially paused) -->
          <g id="waterFlow" transform="translate(160,-50)" opacity="0">
            <g class="waterFlow">
              <circle class="drop" cx="20" cy="10" r="6" fill="#4da6ff" opacity="0.9"/>
              <circle class="drop" cx="-40" cy="20" r="6" fill="#4da6ff" opacity="0.8"/>
              <circle class="drop" cx="-90" cy="5" r="6" fill="#4da6ff" opacity="0.7"/>
            </g>
          </g>

          <!-- text panel under hydro plant -->
          <g id="hydroTextPanel" transform="translate(0,40)">
            <rect class="info-bg" width="360" height="46" />
            <text class="info-panel" x="12" y="28" id="hydroText"></text>
          </g>
        </g>

        <!-- Panel grid pattern for solar panels -->
        <defs>
          <pattern id="panelGrid" patternUnits="userSpaceOnUse" width="12" height="12">
            <rect width="12" height="12" fill="#0b6b8f"></rect>
            <path d="M0,0 L12,0 M0,6 L12,6 M6,0 L6,12" stroke="#083e57" stroke-width="0.8"/>
          </pattern>
        </defs>

      </svg>
    </div>

    <div class="reset-row">
      <div class="hint">Kliknite na objekte: solarne panele, vetroturbine, hidroelektranu ili strelice da vidite tok energije.</div>
      <div>
        <button id="resetBtn">Resetuj</button>
      </div>
    </div>
  </div>

<script>
(function(){
  // State for each interactive object
  const state = {
    solar: { clickCount:0, nextIndex:0, animating:false },
    wind: { clickCount:0, nextIndex:0, animating:false },
    hydro: { clickCount:0, nextIndex:0, animating:false },
    arrowSolar: { active:false },
    arrowWind: { active:false },
    arrowHydro: { active:false }
  };

  // Elements
  const solarGroup = document.getElementById('solarGroup');
  const solarText = document.getElementById('solarText');
  const sunRays = document.getElementById('sunRays');
  const panelGloss = document.getElementById('panelGloss');

  const windArea = document.getElementById('windArea');
  const windText = document.getElementById('windText');
  const blades = [document.getElementById('blades1'), document.getElementById('blades2'), document.getElementById('blades3')];

  const hydroArea = document.getElementById('hydroArea');
  const hydroText = document.getElementById('hydroText');
  const waterFlow = document.getElementById('waterFlow');
  const hydroBlades = document.getElementById('hydroBlades');

  const arrowSolar = document.getElementById('arrowSolar');
  const arrowWind = document.getElementById('arrowWind');
  const arrowHydro = document.getElementById('arrowHydro');

  const resetBtn = document.getElementById('resetBtn');

  // Utility to show text in panels with fade
  function showPanelText(elemTextNode, txt){
    elemTextNode.textContent = txt;
  }

  // Solar interactions per spec
  solarGroup.addEventListener('click', function(){
    const s = state.solar;
    if(s.clickCount === 0){
      // then_first
      showPanelText(solarText, "Solarni paneli proizvode struju od sunčeve svetlosti.");
    } else {
      // then_next sequential
      // Only one then_next - start rays and change text
      if(s.nextIndex === 0){
        // animate sun rays and change text
        sunRays.setAttribute('opacity','1');
        // add pulse class to rays children
        Array.from(sunRays.querySelectorAll('.rayPulse')).forEach(r=> r.style.display = 'block');
        showPanelText(solarText, "Više svetla = više energije.");
        s.animating = true;
        // make panels gloss a bit stronger
        panelGloss.setAttribute('opacity','0.65');
      } else {
        // further clicks toggle off/on animation
        if(s.animating){
          sunRays.setAttribute('opacity','0');
          panelGloss.setAttribute('opacity','0.45');
          s.animating = false;
        } else {
          sunRays.setAttribute('opacity','1');
          panelGloss.setAttribute('opacity','0.75');
          s.animating = true;
        }
      }
      // increment nextIndex but cap
      s.nextIndex = Math.min(s.nextIndex + 1, 1);
    }
    s.clickCount++;
  });

  // Wind interactions
  windArea.addEventListener('click', function(){
    const w = state.wind;
    if(w.clickCount === 0){
      showPanelText(windText, "Vetroturbine proizvode električnu energiju od vetra.");
    } else {
      if(w.nextIndex === 0){
        // add rotation animation to blades
        blades.forEach(b => b.classList.add('spin'));
        showPanelText(windText, "Brzi vetrovi povećavaju proizvodnju.");
        w.animating = true;
      } else {
        // toggle spin
        if(w.animating){
          blades.forEach(b => b.classList.remove('spin'));
          w.animating = false;
        } else {
          blades.forEach(b => b.classList.add('spin'));
          w.animating = true;
        }
      }
      w.nextIndex = Math.min(w.nextIndex + 1, 1);
    }
    w.clickCount++;
  });

  // Hydro interactions
  hydroArea.addEventListener('click', function(){
    const h = state.hydro;
    if(h.clickCount === 0){
      showPanelText(hydroText, "Hidroelektrana proizvodi struju koristeći vodu.");
    } else {
      if(h.nextIndex === 0){
        // start water flow animation (make visible)
        waterFlow.setAttribute('opacity','1');
        // animate drops by toggling CSS class
        Array.from(waterFlow.querySelectorAll('.drop')).forEach((d,i)=>{
          // space and delay them
          d.style.animationDelay = (i*0.15) + 's';
        });
        // spin hydro blades using CSS animation (use JS rotation loop)
        hydroBlades.classList.add('spin');
        showPanelText(hydroText, "Više protoka = veća proizvodnja energije.");
        h.animating = true;
      } else {
        // toggle
        if(h.animating){
          waterFlow.setAttribute('opacity','0');
          hydroBlades.classList.remove('spin');
          h.animating = false;
        } else {
          waterFlow.setAttribute('opacity','1');
          hydroBlades.classList.add('spin');
          h.animating = true;
        }
      }
      h.nextIndex = Math.min(h.nextIndex + 1, 1);
    }
    h.clickCount++;
  });

  // Arrow interactions: show flow animation when clicked
  function toggleArrow(arrowElem, key){
    const st = state[key];
    if(!st.active){
      // apply pulse class to path and show small energy moving dots
      const path = arrowElem.querySelector('path');
      path.classList.add('arrowPulse');
      st.active = true;
      // add transient moving dots along the path using small circles and animate via JS
      const len = path.getTotalLength ? path.getTotalLength() : 300;
      // create group for dots
      let dots = arrowElem.querySelector('.flowDots');
      if(!dots){
        dots = document.createElementNS('http://www.w3.org/2000/svg','g');
        dots.setAttribute('class','flowDots');
        arrowElem.appendChild(dots);
      } else {
        dots.innerHTML = '';
      }
      // create several dots that will move
      for(let i=0;i<6;i++){
        const c = document.createElementNS('http://www.w3.org/2000/svg','circle');
        c.setAttribute('r',6);
        c.setAttribute('fill','#ffd194');
        c.setAttribute('opacity',0.95);
        c.setAttribute('transform','translate(0,0)');
        dots.appendChild(c);
        animateDotAlongPath(c, path, i*350);
      }
    } else {
      const path = arrowElem.querySelector('path');
      path.classList.remove('arrowPulse');
      // remove dots
      const dots = arrowElem.querySelector('.flowDots');
      if(dots) dots.remove();
      st.active = false;
    }
  }

  function animateDotAlongPath(circle, path, offset){
    // animate using requestAnimationFrame
    let start = null;
    const duration = 1400;
    function step(ts){
      if(!start) start = ts;
      const elapsed = (ts - start + offset) % duration;
      const t = elapsed / duration; // 0..1
      // get point
      const len = path.getTotalLength();
      const point = path.getPointAtLength(t * len);
      circle.setAttribute('cx', point.x);
      circle.setAttribute('cy', point.y);
      // loop
      circle._raf = requestAnimationFrame(step);
    }
    circle._raf = requestAnimationFrame(step);
  }

  // Clean up dot animations when toggling off
  function cancelDotAnimations(arrowElem){
    const dots = arrowElem.querySelectorAll('.flowDots circle');
    dots.forEach(c=>{
      if(c._raf) cancelAnimationFrame(c._raf);
    });
  }

  arrowSolar.addEventListener('click', function(e){
    toggleArrow(arrowSolar, 'arrowSolar');
  });
  arrowWind.addEventListener('click', function(e){
    toggleArrow(arrowWind, 'arrowWind');
  });
  arrowHydro.addEventListener('click', function(e){
    toggleArrow(arrowHydro, 'arrowHydro');
  });

  // Reset functionality
  resetBtn.addEventListener('click', function(){
    // reset states
    state.solar = { clickCount:0, nextIndex:0, animating:false };
    state.wind = { clickCount:0, nextIndex:0, animating:false };
    state.hydro = { clickCount:0, nextIndex:0, animating:false };
    state.arrowSolar.active = false;
    state.arrowWind.active = false;
    state.arrowHydro.active = false;

    // clear texts
    solarText.textContent = '';
    windText.textContent = '';
    hydroText.textContent = '';

    // stop solar rays and restore gloss
    sunRays.setAttribute('opacity','0');
    panelGloss.setAttribute('opacity','0.45');

    // stop wind blades
    blades.forEach(b => b.classList.remove('spin'));

    // stop hydro
    waterFlow.setAttribute('opacity','0');
    hydroBlades.classList.remove('spin');

    // stop arrow pulses and remove dots
    [arrowSolar, arrowWind, arrowHydro].forEach(a=>{
      const p = a.querySelector('path');
      if(p) p.classList.remove('arrowPulse');
      cancelDotAnimations(a);
      const fd = a.querySelector('.flowDots');
      if(fd) fd.remove();
    });
  });

  // Accessibility: allow keyboard activation (Enter/Space) on groups
  [solarGroup, windArea, hydroArea, arrowSolar, arrowWind, arrowHydro].forEach(el=>{
    el.setAttribute('tabindex', '0');
    el.addEventListener('keydown', function(e){
      if(e.key === 'Enter' || e.key === ' '){
        e.preventDefault();
        el.click();
      }
    });
  });

  // Small initial static visuals (per "initial" description)
  // Show subtle arrows and city labels already visible; (already drawn)
  // Ensure initial panel texts are empty
  solarText.textContent = '';
  windText.textContent = '';
  hydroText.textContent = '';

  // Safety: on unload, cancel any animations
  window.addEventListener('beforeunload', function(){
    // cancel any RAFs
    [arrowSolar, arrowWind, arrowHydro].forEach(a=>{
      const dots = a.querySelectorAll('.flowDots circle');
      dots.forEach(c=>{
        if(c._raf) cancelAnimationFrame(c._raf);
      });
    });
  });
})();
</script>

</body>
</html>